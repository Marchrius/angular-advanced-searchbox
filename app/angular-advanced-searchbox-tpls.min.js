/*! 
 * angular-advanced-searchbox v3.0.5
 * https://github.com/marchrius/angular-advanced-searchbox
 * Copyright (c) 2018 Nauck IT KG http://www.nauck-it.de/
 * Contributors
 * - Matteo Gaggiano <m.gaggiano@marchirus.org> (http://www.marchrius.org/)
 * Maintainers
 * - Matteo Gaggiano <m.gaggiano@marchirus.org> (http://www.marchrius.org/)
 * License: MIT
 */

!function(){"use strict";angular.module("angular-advanced-searchbox",[]).directive("nitAdvancedSearchbox",function(){return{restrict:"E",scope:{model:"=ngModel",parameters:"=",parametersLabel:"@",parametersDisplayLimit:"=?",placeholder:"@",trashIconClass:"@",searchIconClass:"@",plusIconClass:"@",searchThrottleTime:"=?"},replace:!0,templateUrl:function(e,a){return a.templateUrl||"angular-advanced-searchbox.html"},controller:["$scope","$attrs","$element","$timeout","$filter","setFocusFor",function(k,e,a,s,x,t){function w(){return arguments[arguments.length-1]}var n;k.trashIconClass=k.trashIconClass||"glyphicon glyphicon-trash",k.searchIconClass=k.searchIconClass||"glyphicon glyphicon-search",k.plusIconClass=k.plusIconClass||"glyphicon glyphicon-plus",k.parametersLabel=k.parametersLabel||"Parameter Suggestions",k.parametersDisplayLimit=k.parametersDisplayLimit||8,k.placeholder=k.placeholder||"Search ...",k.searchThrottleTime=k.searchThrottleTime||1e3,k.searchParams=[],k.searchQuery="",k.setFocusFor=t;var i=[];function c(e,P,a,r){n&&s.cancel(n),(i=x("filter")(i,function(e){return e.key!==P&&e.index!==a})).push({command:e,key:P,index:a,value:r}),n=s(function(){angular.forEach(i,function(e){var a,r,t=x("filter")(k.searchParams,function(e){return e.key===P})[0],n=x("filter")(k.parameters,function(e){return e.key===P})[0],s="key",i=n&&!0===n.asObject,c=angular.isObject(e.value)&&n&&"date"!==n.type,l=angular.isDefined(e.value),o="query"===e.key&&angular.isUndefined(n),u=!o&&n&&n.keyTransformer&&angular.isFunction(n.keyTransformer)?n.keyTransformer:w,d=!o&&n&&n.valueTransformer&&angular.isFunction(n.valueTransformer)?n.valueTransformer:w,h=!o&&n&&n.viewKeyTransformer&&angular.isFunction(n.viewKeyTransformer)?n.viewKeyTransformer:w,m=!o&&n&&n.viewValueTransformer&&angular.isFunction(n.viewValueTransformer)?n.viewValueTransformer:w,f=e.value;if(!o){l&&(c?(s=n.viewKey,r=f[n.viewValue],a=f[s],f=i?f:f[s]):f=i?{value:f}:f);var v=f,p=P,g=a,y=r;P=u(n,t,g,p),f=d(n,t,y,v),a=h(n,t,g,p),r=m(n,t,y,v),e.value=f,e.key=P}n&&n.allowMultiple?(angular.isArray(k.model[e.key])||(k.model[e.key]=[]),"delete"===e.command?(k.model[e.key].splice(e.index,1),0===k.model[e.key].length&&delete k.model[e.key]):k.model[e.key][e.index]=e.value):"delete"===e.command?delete k.model[e.key]:k.model[e.key]=e.value,t&&(t.$$view={key:P,value:f,viewKey:s,viewValue:r})}),i.length=0,k.$emit("advanced-searchbox:modelUpdated",k.model)},k.searchThrottleTime)}k.$watch("model",function(e,a){if(!angular.equals(e,a)){angular.forEach(k.model,function(e,a){if("query"===a&&k.searchQuery!==e)k.searchQuery=e;else{var t=x("filter")(k.parameters,function(e){return e.key===a})[0],n=x("filter")(k.searchParams,function(e){return e.key===a});if(void 0!==t)if(t.allowMultiple){if(angular.isArray(e)||(e=[e]),e.forEach(function(e,a){if(n.some(function(e){return e.index===a})){var r=n.filter(function(e){return e.index===a});r[0].value!==e&&(r[0].value=e)}else k.addSearchParam(t,e,!1)}),e.length<n.length)for(var r=e.length;r<n.length;r++)k.removeSearchParam(k.searchParams.indexOf(n[r]))}else 0===n.length?k.addSearchParam(t,e,!1):n[0].value!==e&&(n[0].value=e)}});for(var r=k.searchParams.length-1;0<=r;r--){var t=k.searchParams[r];if(!k.model.hasOwnProperty(t.key)){var n=k.searchParams.map(function(e){return e.key}).indexOf(t.key);k.removeSearchParam(n)}}}},!0),k.searchParamValueChanged=function(e){c("change",e.key,e.index,e.value)},k.searchQueryChanged=function(e){c("change","query",0,e)},k.enterEditMode=function(e,a){if(void 0!==e&&e.stopPropagation(),void 0!==a){var r=k.searchParams[a];r.editMode=!0,t("searchParam:"+r.key),k.$emit("advanced-searchbox:enteredEditMode",r)}},k.leaveEditMode=function(e,a){if(void 0!==a){var r=k.searchParams[a];r.editMode=!1,k.$emit("advanced-searchbox:leavedEditMode",r),r.value||k.removeSearchParam(a)}},k.searchQueryTypeaheadOnSelect=function(e,a,r){k.addSearchParam(e),k.searchQuery="",c("delete","query",0)},k.searchParamTypeaheadOnSelect=function(e,a){a.value=e,k.searchParamValueChanged(a)},k.isUnsedParameter=function(a,e){return 0===x("filter")(k.searchParams,function(e){return e.key===a.key&&!e.allowMultiple}).length},k.addSearchParam=function(a,e,r){if(void 0===r&&(r=!0),k.isUnsedParameter(a)){var t=0;a.allowMultiple&&(t=x("filter")(k.searchParams,function(e){return e.key===a.key}).length);var n=k.searchParams.push({key:a.key,viewKey:a.viewKey,viewValue:a.viewValue,name:a.name,type:a.type||"text",placeholder:a.placeholder,allowMultiple:a.allowMultiple||!1,suggestedValues:a.suggestedValues||[],restrictToSuggestedValues:a.restrictToSuggestedValues||!1,index:t,value:e||""})-1;c("add",a.key,t,e),!0===r&&s(function(){k.enterEditMode(void 0,n)},100),k.$emit("advanced-searchbox:addedSearchParam",a)}},k.removeSearchParam=function(e){if(void 0!==e){var a=k.searchParams[e];if(k.searchParams.splice(e,1),a.allowMultiple)for(var r=x("filter")(k.searchParams,function(e){return e.key===a.key}),t=0;t<r.length;t++)r[t].index=t;c("delete",a.key,a.index),k.$emit("advanced-searchbox:removedSearchParam",a)}},k.removeAll=function(){k.searchParams.length=0,k.searchQuery="",k.model={},k.$emit("advanced-searchbox:removedAllSearchParam")},k.editPrevious=function(e){void 0!==e&&k.leaveEditMode(void 0,e),0<e?k.enterEditMode(void 0,e-1):0<k.searchParams.length?k.enterEditMode(void 0,k.searchParams.length-1):0===k.searchParams.length&&t("searchbox")},k.editNext=function(e){void 0!==e&&(k.leaveEditMode(void 0,e),e<k.searchParams.length-1?k.enterEditMode(void 0,e+1):t("searchbox"))},k.keydown=function(e,a){if(-1!==[8,9,13,37,39].indexOf(e.which)){var r=function(e){if(!e)return 0;try{if("number"==typeof e.selectionStart)return"backward"===e.selectionDirection?e.selectionStart:e.selectionEnd;if(document.selection){e.focus();var a=document.selection.createRange(),r=document.selection.createRange().text.length;return a.moveStart("character",-e.value.length),a.text.length-r}}catch(e){}return 0}(e.target);8==e.which?0===r&&(e.preventDefault(),k.editPrevious(a)):9==e.which?e.shiftKey?(e.preventDefault(),k.editPrevious(a)):(e.preventDefault(),k.editNext(a)):13==e.which?k.editNext(a):37==e.which?0===r&&k.editPrevious(a):39==e.which&&r===e.target.value.length&&k.editNext(a)}},void 0===k.model?k.model={}:angular.forEach(k.model,function(e,a){if("query"===a)k.searchQuery=e;else{var r=x("filter")(k.parameters,function(e){return e.key===a})[0];void 0!==r&&k.addSearchParam(r,e,!1)}})}]}}).filter("flattenObject",[function(){return function(e,a){return angular.isObject(e)?e[a]:e}}]).directive("setFocusOn",[function(){return{restrict:"A",link:function(e,r,t){return e.$on("advanced-searchbox:setFocusOn",function(e,a){if(a===t.setFocusOn)return r[0].focus()})}}}]).factory("setFocusFor",["$rootScope","$timeout",function(a,r){return function(e){return r(function(){return a.$broadcast("advanced-searchbox:setFocusOn",e)})}}]).directive("nitAutoSizeInput",["$timeout",function(l){return{restrict:"A",scope:{model:"=ngModel"},link:function(e,a,r){var t=["text","search","tel","url","email","password","number"],n=angular.element('<div style="position: fixed; top: -9999px; left: 0px;"></div>'),s=angular.element('<span style="white-space:pre;"></span>'),i="none"===a.css("maxWidth")?a.parent().innerWidth():a.css("maxWidth");function c(){l(function(){-1!==t.indexOf(a[0].type||"text")&&(s.text(a.val()||a.attr("placeholder")),a.css("width",s.outerWidth()+10))})}a.css("maxWidth",i),angular.forEach(["fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderLeftWidth","borderRightWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(e){s.css(e,a.css(e))}),angular.element("body").append(n.append(s)),c(),e.model?e.$watch("model",function(){c()}):a.on("keypress keyup keydown focus input propertychange change",function(){c()})}}}])}(),angular.module("angular-advanced-searchbox").run(["$templateCache",function(e){"use strict";e.put("angular-advanced-searchbox.html",'<div class=advancedSearchBox ng-class={active:focus} ng-init="focus = false" ng-click="!focus ? setFocusFor(\'searchbox\') : null"><span ng-show="searchParams.length < 1 && searchQuery.length === 0" class="search-icon {{searchIconClass}}"></span> <a ng-href="" ng-show="searchParams.length > 0 || searchQuery.length > 0" ng-click=removeAll() role=button><span class="remove-all-icon {{trashIconClass}}"></span></a><div><div class=search-parameter ng-repeat="searchParam in searchParams"><a ng-href="" ng-click=removeSearchParam($index) role=button><span class="remove {{trashIconClass}}"></span></a><div class=key data-nit-key={{searchParam.key}} ng-click="enterEditMode($event, $index)">{{searchParam.name}}:</div><div class=value><span ng-show=!searchParam.editMode ng-click="enterEditMode($event, $index)">{{searchParam.$$view.viewValue || searchParam.$$view.value}}</span> <input name=value type={{searchParam.type}} nit-auto-size-input set-focus-on="{{\'searchParam:\' + searchParam.key}}" ng-keydown="keydown($event, $index)" ng-click="enterEditMode($event, $index)" ng-blur="leaveEditMode($event, $index)" ng-show=searchParam.editMode ng-change="searchParam.restrictToSuggestedValues !== true ? searchParamValueChanged(searchParam) : null" ng-model=searchParam.value uib-typeahead="sv | flattenObject:searchParam.viewKey as sv | flattenObject:searchParam.viewValue for sv in searchParam.suggestedValues | filter:$viewValue" typeahead-min-length=0 typeahead-on-select="searchParamTypeaheadOnSelect($item, searchParam)" typeahead-editable="searchParam.restrictToSuggestedValues !== true" typeahead-select-on-exact=true typeahead-select-on-blur="searchParam.restrictToSuggestedValues !== true ? false : true" placeholder={{searchParam.placeholder}}></div></div><input name=searchbox class=search-parameter-input nit-auto-size-input set-focus-on=searchbox ng-keydown=keydown($event) placeholder={{placeholder}} ng-focus="focus = true" ng-blur="focus = false" uib-typeahead="parameter as parameter.name for parameter in parameters | filter:isUnsedParameter | filter:{name:$viewValue} | limitTo:parametersDisplayLimit" typeahead-on-select="searchQueryTypeaheadOnSelect($item, $model, $label)" ng-change=searchQueryChanged(searchQuery) ng-model=searchQuery></div><div class=search-parameter-suggestions ng-show="parameters && focus"><span class=title>{{parametersLabel}}:</span> <span class=search-parameter ng-repeat="param in parameters | filter:isUnsedParameter | limitTo:parametersDisplayLimit" data-key={{param.key}} ng-mousedown=addSearchParam(param)>{{param.name}} <i ng-class="{ plusIconClass: param.allowMultiple}"></i></span></div></div>')}]);