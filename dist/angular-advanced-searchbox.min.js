/*! 
 * angular-advanced-searchbox v3.0.4
 * https://github.com/marchrius/angular-advanced-searchbox
 * Copyright (c) 2018 Nauck IT KG http://www.nauck-it.de/
 * Contributors
 * - Matteo Gaggiano <m.gaggiano@marchirus.org> (http://www.marchrius.org/)
 * Maintainers
 * - Matteo Gaggiano <m.gaggiano@marchirus.org> (http://www.marchrius.org/)
 * License: MIT
 */

!function(){"use strict";angular.module("angular-advanced-searchbox",[]).directive("nitAdvancedSearchbox",function(){return{restrict:"E",scope:{model:"=ngModel",parameters:"=",parametersLabel:"@",parametersDisplayLimit:"=?",placeholder:"@",trashIconClass:"@",searchIconClass:"@",plusIconClass:"@",searchThrottleTime:"=?"},replace:!0,templateUrl:function(e,a){return a.templateUrl||"angular-advanced-searchbox.html"},controller:["$scope","$attrs","$element","$timeout","$filter","setFocusFor",function(x,e,a,i,P,t){function k(e){return e}var n;x.trashIconClass=x.trashIconClass||"glyphicon glyphicon-trash",x.searchIconClass=x.searchIconClass||"glyphicon glyphicon-search",x.plusIconClass=x.plusIconClass||"glyphicon glyphicon-plus",x.parametersLabel=x.parametersLabel||"Parameter Suggestions",x.parametersDisplayLimit=x.parametersDisplayLimit||8,x.placeholder=x.placeholder||"Search ...",x.searchThrottleTime=x.searchThrottleTime||1e3,x.searchParams=[],x.searchQuery="",x.setFocusFor=t;var o=[];function l(e,g,a,r){n&&i.cancel(n),(o=P("filter")(o,function(e){return e.key!==g&&e.index!==a})).push({command:e,key:g,index:a,value:r}),n=i(function(){angular.forEach(o,function(e){var a,r,t=P("filter")(x.searchParams,function(e){return e.key===g})[0],n=P("filter")(x.parameters,function(e){return e.key===g})[0],i="key",o=n&&!0===n.asObject,l=angular.isObject(e.value),c=angular.isDefined(e.value),s="query"===e.key&&angular.isUndefined(n),u=!s&&n.keyTransformer&&angular.isFunction(n.keyTransformer)?n.keyTransformer:k,d=!s&&n.valueTransformer&&angular.isFunction(n.valueTransformer)?n.valueTransformer:k,h=!s&&n.viewKeyTransformer&&angular.isFunction(n.viewKeyTransformer)?n.viewKeyTransformer:k,m=!s&&n.viewValueTransformer&&angular.isFunction(n.viewValueTransformer)?n.viewValueTransformer:k,f=e.value;if(!s){c&&(l?(i=n.viewKey,r=f[n.viewValue],a=f[i],f=o?f:f[i]):f=o?{value:f}:f);var v=f,y=a,p=r;g=u(g),f=d(v),a=h(y),r=m(p),e.value=f,e.key=g}n&&n.allowMultiple?(angular.isArray(x.model[e.key])||(x.model[e.key]=[]),"delete"===e.command?(x.model[e.key].splice(e.index,1),0===x.model[e.key].length&&delete x.model[e.key]):x.model[e.key][e.index]=e.value):"delete"===e.command?delete x.model[e.key]:x.model[e.key]=e.value,t&&(t.$$view={key:g,value:f,viewKey:i,viewValue:r})}),o.length=0,x.$emit("advanced-searchbox:modelUpdated",x.model)},x.searchThrottleTime)}x.$watch("model",function(e,a){if(!angular.equals(e,a)){angular.forEach(x.model,function(e,a){if("query"===a&&x.searchQuery!==e)x.searchQuery=e;else{var t=P("filter")(x.parameters,function(e){return e.key===a})[0],n=P("filter")(x.searchParams,function(e){return e.key===a});if(void 0!==t)if(t.allowMultiple){if(angular.isArray(e)||(e=[e]),e.forEach(function(e,a){if(n.some(function(e){return e.index===a})){var r=n.filter(function(e){return e.index===a});r[0].value!==e&&(r[0].value=e)}else x.addSearchParam(t,e,!1)}),e.length<n.length)for(var r=e.length;r<n.length;r++)x.removeSearchParam(x.searchParams.indexOf(n[r]))}else 0===n.length?x.addSearchParam(t,e,!1):n[0].value!==e&&(n[0].value=e)}});for(var r=x.searchParams.length-1;0<=r;r--){var t=x.searchParams[r];if(!x.model.hasOwnProperty(t.key)){var n=x.searchParams.map(function(e){return e.key}).indexOf(t.key);x.removeSearchParam(n)}}}},!0),x.searchParamValueChanged=function(e){l("change",e.key,e.index,e.value)},x.searchQueryChanged=function(e){l("change","query",0,e)},x.enterEditMode=function(e,a){if(void 0!==e&&e.stopPropagation(),void 0!==a){var r=x.searchParams[a];r.editMode=!0,t("searchParam:"+r.key),x.$emit("advanced-searchbox:enteredEditMode",r)}},x.leaveEditMode=function(e,a){if(void 0!==a){var r=x.searchParams[a];r.editMode=!1,x.$emit("advanced-searchbox:leavedEditMode",r),r.value||x.removeSearchParam(a)}},x.searchQueryTypeaheadOnSelect=function(e,a,r){x.addSearchParam(e),x.searchQuery="",l("delete","query",0)},x.searchParamTypeaheadOnSelect=function(e,a){a.value=e,x.searchParamValueChanged(a)},x.isUnsedParameter=function(a,e){return 0===P("filter")(x.searchParams,function(e){return e.key===a.key&&!e.allowMultiple}).length},x.addSearchParam=function(a,e,r){if(void 0===r&&(r=!0),x.isUnsedParameter(a)){var t=0;a.allowMultiple&&(t=P("filter")(x.searchParams,function(e){return e.key===a.key}).length);var n=x.searchParams.push({key:a.key,viewKey:a.viewKey,viewValue:a.viewValue,name:a.name,type:a.type||"text",placeholder:a.placeholder,allowMultiple:a.allowMultiple||!1,suggestedValues:a.suggestedValues||[],restrictToSuggestedValues:a.restrictToSuggestedValues||!1,index:t,value:e||""})-1;l("add",a.key,t,e),!0===r&&i(function(){x.enterEditMode(void 0,n)},100),x.$emit("advanced-searchbox:addedSearchParam",a)}},x.removeSearchParam=function(e){if(void 0!==e){var a=x.searchParams[e];if(x.searchParams.splice(e,1),a.allowMultiple)for(var r=P("filter")(x.searchParams,function(e){return e.key===a.key}),t=0;t<r.length;t++)r[t].index=t;l("delete",a.key,a.index),x.$emit("advanced-searchbox:removedSearchParam",a)}},x.removeAll=function(){x.searchParams.length=0,x.searchQuery="",x.model={},x.$emit("advanced-searchbox:removedAllSearchParam")},x.editPrevious=function(e){void 0!==e&&x.leaveEditMode(void 0,e),0<e?x.enterEditMode(void 0,e-1):0<x.searchParams.length?x.enterEditMode(void 0,x.searchParams.length-1):0===x.searchParams.length&&t("searchbox")},x.editNext=function(e){void 0!==e&&(x.leaveEditMode(void 0,e),e<x.searchParams.length-1?x.enterEditMode(void 0,e+1):t("searchbox"))},x.keydown=function(e,a){if(-1!==[8,9,13,37,39].indexOf(e.which)){var r=function(e){if(!e)return 0;try{if("number"==typeof e.selectionStart)return"backward"===e.selectionDirection?e.selectionStart:e.selectionEnd;if(document.selection){e.focus();var a=document.selection.createRange(),r=document.selection.createRange().text.length;return a.moveStart("character",-e.value.length),a.text.length-r}}catch(e){}return 0}(e.target);8==e.which?0===r&&(e.preventDefault(),x.editPrevious(a)):9==e.which?e.shiftKey?(e.preventDefault(),x.editPrevious(a)):(e.preventDefault(),x.editNext(a)):13==e.which?x.editNext(a):37==e.which?0===r&&x.editPrevious(a):39==e.which&&r===e.target.value.length&&x.editNext(a)}},void 0===x.model?x.model={}:angular.forEach(x.model,function(e,a){if("query"===a)x.searchQuery=e;else{var r=P("filter")(x.parameters,function(e){return e.key===a})[0];void 0!==r&&x.addSearchParam(r,e,!1)}})}]}}).filter("flattenObject",[function(){return function(e,a){return angular.isObject(e)?e[a]:e}}]).directive("setFocusOn",[function(){return{restrict:"A",link:function(e,r,t){return e.$on("advanced-searchbox:setFocusOn",function(e,a){if(a===t.setFocusOn)return r[0].focus()})}}}]).factory("setFocusFor",["$rootScope","$timeout",function(a,r){return function(e){return r(function(){return a.$broadcast("advanced-searchbox:setFocusOn",e)})}}]).directive("nitAutoSizeInput",["$timeout",function(c){return{restrict:"A",scope:{model:"=ngModel"},link:function(e,a,r){var t=["text","search","tel","url","email","password","number"],n=angular.element('<div style="position: fixed; top: -9999px; left: 0px;"></div>'),i=angular.element('<span style="white-space:pre;"></span>'),o="none"===a.css("maxWidth")?a.parent().innerWidth():a.css("maxWidth");function l(){c(function(){-1!==t.indexOf(a[0].type||"text")&&(i.text(a.val()||a.attr("placeholder")),a.css("width",i.outerWidth()+10))})}a.css("maxWidth",o),angular.forEach(["fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderLeftWidth","borderRightWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(e){i.css(e,a.css(e))}),angular.element("body").append(n.append(i)),l(),e.model?e.$watch("model",function(){l()}):a.on("keypress keyup keydown focus input propertychange change",function(){l()})}}}])}();