/*! 
 * angular-advanced-searchbox v3.0.3
 * https://github.com/marchrius/angular-advanced-searchbox
 * Copyright (c) 2018 Nauck IT KG http://www.nauck-it.de/
 * License: MIT
 */

!function(){"use strict";angular.module("angular-advanced-searchbox",[]).directive("nitAdvancedSearchbox",function(){return{restrict:"E",scope:{model:"=ngModel",parameters:"=",parametersLabel:"@",parametersDisplayLimit:"=?",placeholder:"@",trashIconClass:"@",searchIconClass:"@",plusIconClass:"@",searchThrottleTime:"=?"},replace:!0,templateUrl:function(e,a){return a.templateUrl||"angular-advanced-searchbox.html"},controller:["$scope","$attrs","$element","$timeout","$filter","setFocusFor",function(P,e,a,s,k,t){function x(e){return e}var n;P.trashIconClass=P.trashIconClass||"glyphicon glyphicon-trash",P.searchIconClass=P.searchIconClass||"glyphicon glyphicon-search",P.plusIconClass=P.plusIconClass||"glyphicon glyphicon-plus",P.parametersLabel=P.parametersLabel||"Parameter Suggestions",P.parametersDisplayLimit=P.parametersDisplayLimit||8,P.placeholder=P.placeholder||"Search ...",P.searchThrottleTime=P.searchThrottleTime||1e3,P.searchParams=[],P.searchQuery="",P.setFocusFor=t;var i=[];function c(e,y,a,r){n&&s.cancel(n),(i=k("filter")(i,function(e){return e.key!==y&&e.index!==a})).push({command:e,key:y,index:a,value:r}),n=s(function(){angular.forEach(i,function(e){var a,r,t=k("filter")(P.searchParams,function(e){return e.key===y})[0],n=k("filter")(P.parameters,function(e){return e.key===y})[0],s="key",i=n&&!0===n.asObject,c=angular.isObject(e.value),l=angular.isDefined(e.value),o="query"===e.key&&angular.isUndefined(n),u=!o&&n.keyTransformer&&angular.isFunction(n.keyTransformer)?n.keyTransformer:x,d=!o&&n.valueTransformer&&angular.isFunction(n.valueTransformer)?n.valueTransformer:x,h=!o&&n.viewKeyTransformer&&angular.isFunction(n.viewKeyTransformer)?n.viewKeyTransformer:x,m=!o&&n.viewValueTransformer&&angular.isFunction(n.viewValueTransformer)?n.viewValueTransformer:x,f=e.value;if(!o){l&&(c?(s=n.viewKey,r=f[n.viewValue],a=f[s],f=i?f:f[s]):f=i?{value:f}:f);var v=f,p=a,g=r;y=u(y),f=d(v),a=h(p),r=m(g),e.value=f,e.key=y}n&&n.allowMultiple?(angular.isArray(P.model[e.key])||(P.model[e.key]=[]),"delete"===e.command?(P.model[e.key].splice(e.index,1),0===P.model[e.key].length&&delete P.model[e.key]):P.model[e.key][e.index]=e.value):"delete"===e.command?delete P.model[e.key]:P.model[e.key]=e.value,t&&(t.$$view={key:y,value:f,viewKey:s,viewValue:r})}),i.length=0,P.$emit("advanced-searchbox:modelUpdated",P.model)},P.searchThrottleTime)}P.$watch("model",function(e,a){if(!angular.equals(e,a)){angular.forEach(P.model,function(e,a){if("query"===a&&P.searchQuery!==e)P.searchQuery=e;else{var t=k("filter")(P.parameters,function(e){return e.key===a})[0],n=k("filter")(P.searchParams,function(e){return e.key===a});if(void 0!==t)if(t.allowMultiple){if(angular.isArray(e)||(e=[e]),e.forEach(function(e,a){if(n.some(function(e){return e.index===a})){var r=n.filter(function(e){return e.index===a});r[0].value!==e&&(r[0].value=e)}else P.addSearchParam(t,e,!1)}),e.length<n.length)for(var r=e.length;r<n.length;r++)P.removeSearchParam(P.searchParams.indexOf(n[r]))}else 0===n.length?P.addSearchParam(t,e,!1):n[0].value!==e&&(n[0].value=e)}});for(var r=P.searchParams.length-1;0<=r;r--){var t=P.searchParams[r];if(!P.model.hasOwnProperty(t.key)){var n=P.searchParams.map(function(e){return e.key}).indexOf(t.key);P.removeSearchParam(n)}}}},!0),P.searchParamValueChanged=function(e){c("change",e.key,e.index,e.value)},P.searchQueryChanged=function(e){c("change","query",0,e)},P.enterEditMode=function(e,a){if(void 0!==e&&e.stopPropagation(),void 0!==a){var r=P.searchParams[a];r.editMode=!0,t("searchParam:"+r.key),P.$emit("advanced-searchbox:enteredEditMode",r)}},P.leaveEditMode=function(e,a){if(void 0!==a){var r=P.searchParams[a];r.editMode=!1,P.$emit("advanced-searchbox:leavedEditMode",r),r.value||P.removeSearchParam(a)}},P.searchQueryTypeaheadOnSelect=function(e,a,r){P.addSearchParam(e),P.searchQuery="",c("delete","query",0)},P.searchParamTypeaheadOnSelect=function(e,a){a.value=e,P.searchParamValueChanged(a)},P.isUnsedParameter=function(a,e){return 0===k("filter")(P.searchParams,function(e){return e.key===a.key&&!e.allowMultiple}).length},P.addSearchParam=function(a,e,r){if(void 0===r&&(r=!0),P.isUnsedParameter(a)){var t=0;a.allowMultiple&&(t=k("filter")(P.searchParams,function(e){return e.key===a.key}).length);var n=P.searchParams.push({key:a.key,viewKey:a.viewKey,viewValue:a.viewValue,name:a.name,type:a.type||"text",placeholder:a.placeholder,allowMultiple:a.allowMultiple||!1,suggestedValues:a.suggestedValues||[],restrictToSuggestedValues:a.restrictToSuggestedValues||!1,index:t,value:e||""})-1;c("add",a.key,t,e),!0===r&&s(function(){P.enterEditMode(void 0,n)},100),P.$emit("advanced-searchbox:addedSearchParam",a)}},P.removeSearchParam=function(e){if(void 0!==e){var a=P.searchParams[e];if(P.searchParams.splice(e,1),a.allowMultiple)for(var r=k("filter")(P.searchParams,function(e){return e.key===a.key}),t=0;t<r.length;t++)r[t].index=t;c("delete",a.key,a.index),P.$emit("advanced-searchbox:removedSearchParam",a)}},P.removeAll=function(){P.searchParams.length=0,P.searchQuery="",P.model={},P.$emit("advanced-searchbox:removedAllSearchParam")},P.editPrevious=function(e){void 0!==e&&P.leaveEditMode(void 0,e),0<e?P.enterEditMode(void 0,e-1):0<P.searchParams.length?P.enterEditMode(void 0,P.searchParams.length-1):0===P.searchParams.length&&t("searchbox")},P.editNext=function(e){void 0!==e&&(P.leaveEditMode(void 0,e),e<P.searchParams.length-1?P.enterEditMode(void 0,e+1):t("searchbox"))},P.keydown=function(e,a){if(-1!==[8,9,13,37,39].indexOf(e.which)){var r=function(e){if(!e)return 0;try{if("number"==typeof e.selectionStart)return"backward"===e.selectionDirection?e.selectionStart:e.selectionEnd;if(document.selection){e.focus();var a=document.selection.createRange(),r=document.selection.createRange().text.length;return a.moveStart("character",-e.value.length),a.text.length-r}}catch(e){}return 0}(e.target);8==e.which?0===r&&(e.preventDefault(),P.editPrevious(a)):9==e.which?e.shiftKey?(e.preventDefault(),P.editPrevious(a)):(e.preventDefault(),P.editNext(a)):13==e.which?P.editNext(a):37==e.which?0===r&&P.editPrevious(a):39==e.which&&r===e.target.value.length&&P.editNext(a)}},void 0===P.model?P.model={}:angular.forEach(P.model,function(e,a){if("query"===a)P.searchQuery=e;else{var r=k("filter")(P.parameters,function(e){return e.key===a})[0];void 0!==r&&P.addSearchParam(r,e,!1)}})}]}}).filter("flattenObject",[function(){return function(e,a){return angular.isObject(e)?e[a]:e}}]).directive("setFocusOn",[function(){return{restrict:"A",link:function(e,r,t){return e.$on("advanced-searchbox:setFocusOn",function(e,a){if(a===t.setFocusOn)return r[0].focus()})}}}]).factory("setFocusFor",["$rootScope","$timeout",function(a,r){return function(e){return r(function(){return a.$broadcast("advanced-searchbox:setFocusOn",e)})}}]).directive("nitAutoSizeInput",["$timeout",function(l){return{restrict:"A",scope:{model:"=ngModel"},link:function(e,a,r){var t=["text","search","tel","url","email","password","number"],n=angular.element('<div style="position: fixed; top: -9999px; left: 0px;"></div>'),s=angular.element('<span style="white-space:pre;"></span>'),i="none"===a.css("maxWidth")?a.parent().innerWidth():a.css("maxWidth");function c(){l(function(){-1!==t.indexOf(a[0].type||"text")&&(s.text(a.val()||a.attr("placeholder")),a.css("width",s.outerWidth()+10))})}a.css("maxWidth",i),angular.forEach(["fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderLeftWidth","borderRightWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(e){s.css(e,a.css(e))}),angular.element("body").append(n.append(s)),c(),e.model?e.$watch("model",function(){c()}):a.on("keypress keyup keydown focus input propertychange change",function(){c()})}}}])}(),angular.module("angular-advanced-searchbox").run(["$templateCache",function(e){"use strict";e.put("angular-advanced-searchbox.html",'<div class=advancedSearchBox ng-class={active:focus} ng-init="focus = false" ng-click="!focus ? setFocusFor(\'searchbox\') : null"><span ng-show="searchParams.length < 1 && searchQuery.length === 0" class="search-icon {{searchIconClass}}"></span> <a ng-href="" ng-show="searchParams.length > 0 || searchQuery.length > 0" ng-click=removeAll() role=button><span class="remove-all-icon {{trashIconClass}}"></span></a><div><div class=search-parameter ng-repeat="searchParam in searchParams"><a ng-href="" ng-click=removeSearchParam($index) role=button><span class="remove {{trashIconClass}}"></span></a><div class=key data-nit-key={{searchParam.key}} ng-click="enterEditMode($event, $index)">{{searchParam.name}}:</div><div class=value><span ng-show=!searchParam.editMode ng-click="enterEditMode($event, $index)">{{searchParam.$$view.viewValue || searchParam.value}}</span> <input name=value type={{searchParam.type}} nit-auto-size-input set-focus-on="{{\'searchParam:\' + searchParam.key}}" ng-keydown="keydown($event, $index)" ng-click="enterEditMode($event, $index)" ng-blur="leaveEditMode($event, $index)" ng-show=searchParam.editMode ng-change="searchParam.restrictToSuggestedValues !== true ? searchParamValueChanged(searchParam) : null" ng-model=searchParam.value uib-typeahead="sv | flattenObject:searchParam.viewKey as sv | flattenObject:searchParam.viewValue for sv in searchParam.suggestedValues | filter:$viewValue" typeahead-min-length=0 typeahead-on-select="searchParamTypeaheadOnSelect($item, searchParam)" typeahead-editable="searchParam.restrictToSuggestedValues !== true" typeahead-select-on-exact=true typeahead-select-on-blur="searchParam.restrictToSuggestedValues !== true ? false : true" placeholder={{searchParam.placeholder}}></div></div><input name=searchbox class=search-parameter-input nit-auto-size-input set-focus-on=searchbox ng-keydown=keydown($event) placeholder={{placeholder}} ng-focus="focus = true" ng-blur="focus = false" uib-typeahead="parameter as parameter.name for parameter in parameters | filter:isUnsedParameter | filter:{name:$viewValue} | limitTo:parametersDisplayLimit" typeahead-on-select="searchQueryTypeaheadOnSelect($item, $model, $label)" ng-change=searchQueryChanged(searchQuery) ng-model=searchQuery></div><div class=search-parameter-suggestions ng-show="parameters && focus"><span class=title>{{parametersLabel}}:</span> <span class=search-parameter ng-repeat="param in parameters | filter:isUnsedParameter | limitTo:parametersDisplayLimit" data-key={{param.key}} ng-mousedown=addSearchParam(param)>{{param.name}} <i ng-class="{ plusIconClass: param.allowMultiple}"></i></span></div></div>')}]);